<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Sun</title>
  
  <subtitle>这是一个副标题</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://sunweixiao.com/"/>
  <updated>2018-02-13T12:55:32.386Z</updated>
  <id>http://sunweixiao.com/</id>
  
  <author>
    <name>SunWeixiao</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>P站图片爬虫 Pixiv-Spider</title>
    <link href="http://sunweixiao.com/posts/7/"/>
    <id>http://sunweixiao.com/posts/7/</id>
    <published>2018-02-09T06:37:22.697Z</published>
    <updated>2018-02-13T12:55:32.386Z</updated>
    
    <content type="html"><![CDATA[<p>最近因为工作的原因，接触 Nodejs 也愈加多了起来，从搭建 koa2 后台服务器，到 PM2 管理各种服务进程，虽然期间踩了不少坑也勉强过来了，作为练手写了个P站图片爬虫。<br><a id="more"></a></p><h2 id="关于"><a href="#关于" class="headerlink" title=" 关于"></a><i class="fa fa-gift" aria-hidden="true"></i> 关于</h2><p><code>Pixiv-Spider</code> 是一个P站图片批量下载爬虫，其内集成了三种下载模式：收藏夹模式、关注者模式和作者列表模式，顾名思义，不同模式下会分别下载自己收藏夹的作品、关注的画师作品和自定义提供的画师列表的作品。不仅如此，还可以自定义各种下载筛选条件，包括作品发布日期、点赞数、标签和 R18 禁止。</p><p>项目地址: <a href="www.baidu.com">Pixiv-Spider</a>，欢迎 star ฅ●ω●ฅ。</p><p>食用方式非常简单，先克隆仓库并安装依赖包：</p><pre><code class="git">git clone git@github.com:chanshiyucx/Pixiv-Spider.gitcd Pixiv-Spidernpm install</code></pre><p>待依赖包安装完毕，修改目录下的 <code>config.js</code> 配置文件，填写你的P站账号与密码，自定义下载模式和筛选条件：</p><pre><code class="js">module.exports = {  username: &#39;你的 P 站账号&#39;,  password: &#39;你的 P 站密码&#39;,  mode: &#39;author&#39;, // star: 下载收藏夹, author: 下载作者列表, follow: 下载我关注的作者  date: &#39;&#39;, // 限定日期之内, 可以留空, 注意格式: &#39;2018/01/01&#39;  // 以下是 mode 为 author 或 follow 才有的选项  author: [], // 下载的作者列表  tags: [], // 筛选标签  rated: 0, // 最低点赞数筛选  R18: true // 是否禁止 R18}</code></pre><p>完成之后，执行 <code>npm start</code> 开始下载。到此，<code>Pixiv-Spider</code> 食用教程结束，余下内容分析一些功能的代码具体实现。</p><p><img src="https://dn-coding-net-production-pp.qbox.me/c32dc8a7-4ac1-49d7-a8ff-26e2ab0d7a41.png" alt=""></p><h2 id="代码"><a href="#代码" class="headerlink" title=" 代码"></a><i class="fa fa-gift" aria-hidden="true"></i> 代码</h2><h3 id="启动"><a href="#启动" class="headerlink" title="  启动"></a><i class="fa fa-leaf" aria-hidden="true"></i>  启动</h3><p><code>Pixiv-Spider</code> 爬虫使用了 <code>axios</code> 发送请求， <code>cheerio</code> 解析 DOM，<code>bluebird</code> 封装的 map 函数进行多任务下载。首先，新建个爬虫类如下：</p><pre><code class="js">const fs = require(&#39;fs&#39;)const querystring = require(&#39;querystring&#39;)const axios = require(&#39;axios&#39;)const cheerio = require(&#39;cheerio&#39;)const Promise = require(&#39;bluebird&#39;)// 配置文件const config = require(&#39;./config&#39;)const { username, password, mode, author, tags, rated, date, R18 } = config// 限制日期const temp = (date || &#39;2000/01/01&#39;).split(&#39;/&#39;)const limitDate = new Date()limitDate.setFullYear(+temp[0], +temp[1] - 1, +temp[2])class Pixiv {  constructor () {    this.mode = mode    this.cookie = &#39;&#39;  }  // 启动  async start () {    console.log(&quot;\n程序启动(●&#39;◡&#39;●)  DesignedBy 蝉時雨&quot;)    let showTags = &#39;&#39;    tags.forEach(o =&gt; { showTags += ` ${o}` })    const inx = [&#39;star&#39;, &#39;author&#39;, &#39;follow&#39;].findIndex(o =&gt; o === mode)    const showMode = [&#39;收藏夹模式&#39;, &#39;作者列表模式&#39;, &#39;关注者模式&#39;][inx]    console.log(`当前模式：${showMode}  限定日期: ${date}  ${mode !== &#39;star&#39; ? &#39;筛选标签:&#39; + showTags : &#39;&#39;}`)    // 如果不存在下载目录则新建    if (!fs.existsSync(&#39;download&#39;)) {      fs.mkdirSync(&#39;download&#39;)    }    // 如果不存在 cookie 则登陆获取    if (!fs.existsSync(&#39;cookie.txt&#39;)) {      const key = await this.getKey()      this.cookie = await this.login(key)    } else {      this.cookie = fs.readFileSync(&#39;cookie.txt&#39;, &#39;utf8&#39;)    }    if (this.mode === &#39;star&#39;) {      // 收藏夹模式    } else if (this.mode === &#39;author&#39; &amp;&amp; author.length) {      // 作者列表模式    } else if (this.mode === &#39;follow&#39;) {      // 关注者模式  }}// 开始启动const pixiv = new Pixiv()pixiv.start()</code></pre><h3 id="登陆"><a href="#登陆" class="headerlink" title=" 登陆"></a><i class="fa fa-leaf" aria-hidden="true"></i> 登陆</h3><p>登陆部分代码参考了知乎一篇文章 <a href="www.baidu.com">从零开始教你写一个NPM包</a>，在登陆页面需要获取 <code>post_key</code>，P站使用了该值来防止 CSRF。<br><img src="https://dn-coding-net-production-pp.qbox.me/ca5783ab-69f7-4c32-a88e-67c7ce7fd877.png" alt=""></p><p>至于关注者模式和作者列表模式与收藏夹模式大同小异，只是在下载之前多了两次遍历过程，如有兴趣可直接看仓库代码。</p><p>Just enjoy it ฅ●ω●ฅ</p><h3 id="注意-本文非本人所创，内容来自网络，仅限预览格式"><a href="#注意-本文非本人所创，内容来自网络，仅限预览格式" class="headerlink" title="注意!本文非本人所创，内容来自网络，仅限预览格式"></a>注意!本文非本人所创，内容来自网络，仅限预览格式</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近因为工作的原因，接触 Nodejs 也愈加多了起来，从搭建 koa2 后台服务器，到 PM2 管理各种服务进程，虽然期间踩了不少坑也勉强过来了，作为练手写了个P站图片爬虫。&lt;br&gt;
    
    </summary>
    
      <category term="随想集" scheme="http://sunweixiao.com/categories/thinking/"/>
    
    
  </entry>
  
  <entry>
    <title>新看板娘 Tia の改造记事</title>
    <link href="http://sunweixiao.com/posts/6/"/>
    <id>http://sunweixiao.com/posts/6/</id>
    <published>2018-02-07T16:16:31.000Z</published>
    <updated>2018-02-11T09:38:17.388Z</updated>
    
    <content type="html"><![CDATA[<p>最近 Pio 大有泛滥之势，惨象已使我目不忍视了，或许这其中与我有些干系 ，毕竟当初偷师后流出了一大批模型，但我还有什么话可说呢，好吧已无它法，来加个美美哒新老婆 Tia 吧。</p><a id="more"></a><h1 id="这是大标题"><a href="#这是大标题" class="headerlink" title="这是大标题"></a>这是大标题</h1><p>这是中标题<br>—正<strong>文开始</strong><br>换<em>行了</em>吗<br><br>换行了吗\<br></p><p><br>$a = b + c$<br>$$c = d\\a = x \times y ^{a^b} + \frac{1}{a} / \sqrt{q} + \cdots + \sum\limits_{k=1}^n{a_kn} + \int_0^1 f(x)dx + \underbrace{(1 + 2 + \cdots + n)}_{ｎ个} + \vec a \cdot \alpha + \lim\limits_{x\to\infty}g(x)\\<br>    \begin{matrix}<br>    1 &amp; x &amp; x^2 \\<br>    1 &amp; y &amp; y^2 \\<br>    1 &amp; z &amp; z^2 \\<br>    \end{matrix}$$<br>$$f(n) =<br>\begin{cases}<br>n/2,  &amp; \text{if $n$ is even} \\<br>3n+1, &amp; \text{if $n$ is odd}<br>\end{cases}<br>$$<br>$\left|<br>\begin{array}{lcr}<br>a &amp; b &amp; c \\<br>d &amp; e &amp; f<br>\end{array}<br>\right|$  </p><h2 id="二"><a href="#二" class="headerlink" title="二"></a>二</h2><h3 id="三"><a href="#三" class="headerlink" title="三"></a>三</h3><ul><li>圆点<br></li></ul><p><code>高亮</code>测试</p><pre><code>    单行</code></pre><blockquote><p>一</p><blockquote><p>二</p><blockquote><p>三</p></blockquote></blockquote></blockquote><p><a href="https://sunwx17.github.io" target="_blank" rel="noopener">超链接测试</a></p><p>url图片测试<br><img src="https://github.com/sunwx17/picture/raw/master/0.jpg" alt="图片测试"></p><p>代码测试</p><pre><code class="c++">#include &lt;iostream&gt;using namespace std;int main(){    int n, sum = 0;    cin &gt;&gt; n;    for (int i = 0; i &lt; n; i++){        sum += i;    }    cout &lt;&lt; sum;    return 0;}</code></pre><pre><code class="python">import socketdef hhh(){    pass}</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近 Pio 大有泛滥之势，惨象已使我目不忍视了，或许这其中与我有些干系 ，毕竟当初偷师后流出了一大批模型，但我还有什么话可说呢，好吧已无它法，来加个美美哒新老婆 Tia 吧。&lt;/p&gt;
    
    </summary>
    
      <category term="笔记本" scheme="http://sunweixiao.com/categories/notebook/"/>
    
    
  </entry>
  
  <entry>
    <title>Vim 哲思</title>
    <link href="http://sunweixiao.com/posts/1/"/>
    <id>http://sunweixiao.com/posts/1/</id>
    <published>2018-02-07T16:00:00.000Z</published>
    <updated>2018-02-11T09:36:20.398Z</updated>
    
    <content type="html"><![CDATA[<p>说起来惭愧，作为一个程序员怎能不懂 Vim，一直以来对 Vim 只是略知皮毛，目前也只在编辑小文本时偶尔用到。当初几次尝试使用 Vim 都感觉刻意使用反而增加了负担，拖慢了效率。<br><a id="more"></a></p><h3 id="nothing"><a href="#nothing" class="headerlink" title="nothing"></a>nothing</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;说起来惭愧，作为一个程序员怎能不懂 Vim，一直以来对 Vim 只是略知皮毛，目前也只在编辑小文本时偶尔用到。当初几次尝试使用 Vim 都感觉刻意使用反而增加了负担，拖慢了效率。&lt;br&gt;
    
    </summary>
    
      <category term="技术向" scheme="http://sunweixiao.com/categories/technology/"/>
    
    
      <category term="java" scheme="http://sunweixiao.com/tags/java/"/>
    
      <category term="数据库" scheme="http://sunweixiao.com/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>RN App 唤醒踩坑记</title>
    <link href="http://sunweixiao.com/posts/2/"/>
    <id>http://sunweixiao.com/posts/2/</id>
    <published>2018-02-07T06:19:06.000Z</published>
    <updated>2018-02-11T09:37:37.203Z</updated>
    
    <content type="html"><![CDATA[<p>最近接手的新项目需要实现链接分享功能，然后通过分享的链接唤醒 App 并进行页面跳转，需要同时兼容 iOS 和 Android，不幸这趟坑就让我踩了， 那就只能拥抱新技术吧。<br><a id="more"></a></p><h1 id="没有正文"><a href="#没有正文" class="headerlink" title="没有正文"></a>没有正文</h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近接手的新项目需要实现链接分享功能，然后通过分享的链接唤醒 App 并进行页面跳转，需要同时兼容 iOS 和 Android，不幸这趟坑就让我踩了， 那就只能拥抱新技术吧。&lt;br&gt;
    
    </summary>
    
      <category term="自言语" scheme="http://sunweixiao.com/categories/tomyself/"/>
    
    
      <category term="标签0" scheme="http://sunweixiao.com/tags/%E6%A0%87%E7%AD%BE0/"/>
    
      <category term="标签1" scheme="http://sunweixiao.com/tags/%E6%A0%87%E7%AD%BE1/"/>
    
  </entry>
  
  <entry>
    <title>本地文件插入测试</title>
    <link href="http://sunweixiao.com/posts/5/"/>
    <id>http://sunweixiao.com/posts/5/</id>
    <published>2018-02-07T06:01:12.000Z</published>
    <updated>2018-02-11T09:38:04.568Z</updated>
    
    <content type="html"><![CDATA[<p>图片0<br><img src="/posts/5/0.jpg" title="图片0"><br>图片1<br><img src="/posts/5/1.jpg" title="图片1"><br>图片2<br><img src="/posts/5/2.jpg" title="图片2"><br>图片3<br><img src="/posts/5/3.jpg" title="图片3"><br>图片4</p><p><img src="/image/0.jpg" alt=""></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;图片0&lt;br&gt;&lt;img src=&quot;/posts/5/0.jpg&quot; title=&quot;图片0&quot;&gt;&lt;br&gt;图片1&lt;br&gt;&lt;img src=&quot;/posts/5/1.jpg&quot; title=&quot;图片1&quot;&gt;&lt;br&gt;图片2&lt;br&gt;&lt;img src=&quot;/posts/5/2.jpg&quot; title=
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>草稿</title>
    <link href="http://sunweixiao.com/posts/4/"/>
    <id>http://sunweixiao.com/posts/4/</id>
    <published>2018-02-07T05:37:41.000Z</published>
    <updated>2018-02-11T09:37:47.777Z</updated>
    
    <content type="html"><![CDATA[<p>这是一篇草稿发表的实验</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;这是一篇草稿发表的实验&lt;/p&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>测试页面 Hello World!</title>
    <link href="http://sunweixiao.com/posts/3/"/>
    <id>http://sunweixiao.com/posts/3/</id>
    <published>2018-02-06T16:43:45.585Z</published>
    <updated>2018-02-11T09:37:02.818Z</updated>
    
    <content type="html"><![CDATA[<h1 id="这是大标题"><a href="#这是大标题" class="headerlink" title="这是大标题"></a>这是大标题</h1><h2 id="这是中标题"><a href="#这是中标题" class="headerlink" title="这是中标题"></a>这是中标题</h2><a id="more"></a><p>正文开始<br>换行了吗<br><br>换行了吗\<br></p><h2 id="二"><a href="#二" class="headerlink" title="二"></a>二</h2><h3 id="三"><a href="#三" class="headerlink" title="三"></a>三</h3><ul><li>圆点<br></li></ul><p><code>高亮</code>测试</p><pre><code>    单行</code></pre><blockquote><p>一</p><blockquote><p>二</p><blockquote><p>三</p></blockquote></blockquote></blockquote><p><a href="https://sunwx17.github.io" target="_blank" rel="noopener">超链接测试</a></p><p>url图片测试<br><img src="https://github.com/sunwx17/picture/raw/master/0.jpg" alt="图片测试"></p><p>代码测试</p><pre><code class="c++">#include &lt;iostream&gt;using namespace std;int main(){    int n, sum = 0;    cin &gt;&gt; n;    for (int i = 0; i &lt; n; i++){        sum += i;    }    cout &lt;&lt; sum;    return 0;}</code></pre><pre><code class="python">import socketdef hhh(){    pass}</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;这是大标题&quot;&gt;&lt;a href=&quot;#这是大标题&quot; class=&quot;headerlink&quot; title=&quot;这是大标题&quot;&gt;&lt;/a&gt;这是大标题&lt;/h1&gt;&lt;h2 id=&quot;这是中标题&quot;&gt;&lt;a href=&quot;#这是中标题&quot; class=&quot;headerlink&quot; title=&quot;这是中标题&quot;&gt;&lt;/a&gt;这是中标题&lt;/h2&gt;
    
    </summary>
    
    
  </entry>
  
</feed>
